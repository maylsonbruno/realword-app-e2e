{"version":3,"file":"C:/Users/full/Desktop/RealWordApp/cypress-realworld-app/backend/notification-routes.ts","sources":["C:/Users/full/Desktop/RealWordApp/cypress-realworld-app/backend/notification-routes.ts"],"names":[],"mappings":";AAAA,gCAAgC;;;;;;;;;;;;;;AAEhC,oDAA8B;AAC9B,uCAIoB;AACpB,qCAAoE;AACpE,2CAIsB;AACtB,IAAM,MAAM,GAAG,iBAAO,CAAC,MAAM,EAAE,CAAC;AAEhC,SAAS;AAET,qBAAqB;AACrB,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,6BAAmB,EAAE,UAAC,GAAG,EAAE,GAAG;;IAC5C,0BAA0B;IAC1B,IAAM,aAAa,GAAG,IAAA,yCAA8B,EAAC,MAAA,GAAG,CAAC,IAAI,0CAAE,EAAG,CAAC,CAAC;IAEpE,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;IAChB,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,aAAa,EAAE,CAAC,CAAC;AACvC,CAAC,CAAC,CAAC;AAEH,0BAA0B;AAC1B,MAAM,CAAC,IAAI,CACT,OAAO,EACP,6BAAmB,EACnB,IAAA,4BAAkB,oBAAK,yCAA4B,QAAE,EACrD,UAAC,GAAG,EAAE,GAAG;;IACC,IAAA,KAAK,GAAK,GAAG,CAAC,IAAI,MAAb,CAAc;IAC3B,0BAA0B;IAC1B,IAAM,aAAa,GAAG,IAAA,8BAAmB,EAAC,MAAA,GAAG,CAAC,IAAI,0CAAE,EAAG,EAAE,KAAK,CAAC,CAAC;IAEhE,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;IAChB,aAAa;IACb,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,aAAa,EAAE,CAAC,CAAC;AACvC,CAAC,CACF,CAAC;AAEF,oDAAoD;AACpD,MAAM,CAAC,KAAK,CACV,kBAAkB,EAClB,6BAAmB,EACnB,IAAA,4BAAkB,iBAAE,IAAA,8BAAiB,EAAC,gBAAgB,CAAC,GAAK,yCAA4B,QAAE,EAC1F,UAAC,GAAG,EAAE,GAAG;;IACC,IAAA,cAAc,GAAK,GAAG,CAAC,MAAM,eAAf,CAAgB;IACtC,0BAA0B;IAC1B,IAAA,iCAAsB,EAAC,MAAA,GAAG,CAAC,IAAI,0CAAE,EAAG,EAAE,cAAc,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC;IAEhE,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;AACtB,CAAC,CACF,CAAC;AAEF,kBAAe,MAAM,CAAC","sourcesContent":["///<reference path=\"types.ts\" />\r\n\r\nimport express from \"express\";\r\nimport {\r\n  createNotifications,\r\n  updateNotificationById,\r\n  getUnreadNotificationsByUserId,\r\n} from \"./database\";\r\nimport { ensureAuthenticated, validateMiddleware } from \"./helpers\";\r\nimport {\r\n  isNotificationsBodyValidator,\r\n  shortIdValidation,\r\n  isNotificationPatchValidator,\r\n} from \"./validators\";\r\nconst router = express.Router();\r\n\r\n// Routes\r\n\r\n//GET /notifications/\r\nrouter.get(\"/\", ensureAuthenticated, (req, res) => {\r\n  /* istanbul ignore next */\r\n  const notifications = getUnreadNotificationsByUserId(req.user?.id!);\r\n\r\n  res.status(200);\r\n  res.json({ results: notifications });\r\n});\r\n\r\n//POST /notifications/bulk\r\nrouter.post(\r\n  \"/bulk\",\r\n  ensureAuthenticated,\r\n  validateMiddleware([...isNotificationsBodyValidator]),\r\n  (req, res) => {\r\n    const { items } = req.body;\r\n    /* istanbul ignore next */\r\n    const notifications = createNotifications(req.user?.id!, items);\r\n\r\n    res.status(200);\r\n    // @ts-ignore\r\n    res.json({ results: notifications });\r\n  }\r\n);\r\n\r\n//PATCH /notifications/:notificationId - scoped-user\r\nrouter.patch(\r\n  \"/:notificationId\",\r\n  ensureAuthenticated,\r\n  validateMiddleware([shortIdValidation(\"notificationId\"), ...isNotificationPatchValidator]),\r\n  (req, res) => {\r\n    const { notificationId } = req.params;\r\n    /* istanbul ignore next */\r\n    updateNotificationById(req.user?.id!, notificationId, req.body);\r\n\r\n    res.sendStatus(204);\r\n  }\r\n);\r\n\r\nexport default router;\r\n"]}
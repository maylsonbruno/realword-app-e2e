{"version":3,"file":"C:/Users/full/Desktop/RealWordApp/cypress-realworld-app/backend/user-routes.ts","sources":["C:/Users/full/Desktop/RealWordApp/cypress-realworld-app/backend/user-routes.ts"],"names":[],"mappings":"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","sourcesContent":["///<reference path=\"types.ts\" />\r\n\r\nimport express from \"express\";\r\nimport { isEqual, pick } from \"lodash/fp\";\r\n\r\nimport {\r\n  getAllUsers,\r\n  createUser,\r\n  updateUserById,\r\n  getUserById,\r\n  getUserByUsername,\r\n  searchUsers,\r\n  removeUserFromResults,\r\n} from \"./database\";\r\nimport { User } from \"../src/models/user\";\r\nimport { ensureAuthenticated, validateMiddleware } from \"./helpers\";\r\nimport {\r\n  shortIdValidation,\r\n  searchValidation,\r\n  userFieldsValidator,\r\n  isUserValidator,\r\n} from \"./validators\";\r\nconst router = express.Router();\r\n\r\n// Routes\r\nrouter.get(\"/\", ensureAuthenticated, (req, res) => {\r\n  /* istanbul ignore next */\r\n  const users = removeUserFromResults(req.user?.id!, getAllUsers());\r\n  res.status(200).json({ results: users });\r\n});\r\n\r\nrouter.get(\"/search\", ensureAuthenticated, validateMiddleware([searchValidation]), (req, res) => {\r\n  const { q } = req.query;\r\n\r\n  /* istanbul ignore next */\r\n  const users = removeUserFromResults(req.user?.id!, searchUsers(q as string));\r\n\r\n  res.status(200).json({ results: users });\r\n});\r\n\r\nrouter.post(\"/\", userFieldsValidator, validateMiddleware(isUserValidator), (req, res) => {\r\n  const userDetails: User = req.body;\r\n\r\n  const user = createUser(userDetails);\r\n\r\n  res.status(201);\r\n  res.json({ user: user });\r\n});\r\n\r\nrouter.get(\r\n  \"/:userId\",\r\n  ensureAuthenticated,\r\n  validateMiddleware([shortIdValidation(\"userId\")]),\r\n  (req, res) => {\r\n    const { userId } = req.params;\r\n\r\n    // Permission: account owner\r\n    /* istanbul ignore next */\r\n    if (!isEqual(userId, req.user?.id)) {\r\n      return res.status(401).send({\r\n        error: \"Unauthorized\",\r\n      });\r\n    }\r\n\r\n    const user = getUserById(userId);\r\n\r\n    res.status(200);\r\n    res.json({ user });\r\n  }\r\n);\r\n\r\nrouter.get(\"/profile/:username\", (req, res) => {\r\n  const { username } = req.params;\r\n\r\n  const user = pick([\"firstName\", \"lastName\", \"avatar\"], getUserByUsername(username));\r\n\r\n  res.status(200);\r\n  res.json({ user });\r\n});\r\n\r\nrouter.patch(\r\n  \"/:userId\",\r\n  ensureAuthenticated,\r\n  userFieldsValidator,\r\n  validateMiddleware([shortIdValidation(\"userId\"), ...isUserValidator]),\r\n  (req, res) => {\r\n    const { userId } = req.params;\r\n\r\n    const edits: User = req.body;\r\n\r\n    updateUserById(userId, edits);\r\n\r\n    res.sendStatus(204);\r\n  }\r\n);\r\n\r\nexport default router;\r\n"]}